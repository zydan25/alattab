<!-- <!DOCTYPE html>

<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</title>
  <style>
    body {
      font-family: "Tahoma", sans-serif;
      background: #f7f9fc;
      padding: 20px;
      direction: rtl;
      text-align: right;
    }
    h2 {
      text-align: center;
      color: #333;
    }
    .controls {
      margin-bottom: 15px;
      display: flex;
      gap: 10px;
      justify-content: flex-start;
    }
    select, button, input {
      padding: 6px 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background: #007bff;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 8px;
      border: 1px solid #ddd;
      text-align: center;
    }
    th {
      background: #f1f1f1;
      cursor: pointer;
    }
    tr:hover {
      background: #f9f9f9;
    }
    .daily {
      color: green;
      font-weight: bold;
    }
    .not-daily {
      color: red;
    }
  </style>
</head>
<body>

  <h2>Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</h2>

  <div class="controls">
    <label for="clientFilter">ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
    <select id="clientFilter">
      <option value="">Ø§Ù„ÙƒÙ„</option>
      <option value="Ø¹Ù…ÙŠÙ„ 1">Ø¹Ù…ÙŠÙ„ 1</option>
      <option value="Ø¹Ù…ÙŠÙ„ 2">Ø¹Ù…ÙŠÙ„ 2</option>
      <option value="Ø¹Ù…ÙŠÙ„ 3">Ø¹Ù…ÙŠÙ„ 3</option>
    </select>

    <button onclick="sendReport()">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ±</button>
  </div>

  <table id="recordsTable">
    <thead>
      <tr>
        <th onclick="sortTable(0)">Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
        <th onclick="sortTable(1)">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
        <th onclick="sortTable(2)">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ (GB)</th>
        <th onclick="sortTable(3)">Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ (GB)</th>
        <th onclick="sortTable(4)">Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ù…Ù†Ø° Ø¢Ø®Ø± ØªÙ‚Ø±ÙŠØ± (GB)</th>
        <th onclick="sortTable(5)">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
        <th onclick="sortTable(6)">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ</th>
        <th onclick="sortTable(7)">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</th>
        <th onclick="sortTable(8)">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</th>
      </tr>
    </thead>
    <tbody>
      <!-- Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© 
      <tr data-client="Ø¹Ù…ÙŠÙ„ 1">
        <td>Ø¹Ù…ÙŠÙ„ 1</td>
        <td>04421857</td>
        <td>67.95</td>
        <td>0.24</td>
        <td>0.24</td>
        <td>7134.75</td>
        <td>25.2</td>
        <td>2025-10-02 21:45</td>
        <td class="daily">ÙŠÙˆÙ…ÙŠ</td>
      </tr>
      <tr data-client="Ø¹Ù…ÙŠÙ„ 2">
        <td>Ø¹Ù…ÙŠÙ„ 2</td>
        <td>05544556</td>
        <td>50.12</td>
        <td>1.2</td>
        <td>3.4</td>
        <td>6000</td>
        <td>130</td>
        <td>2025-10-02 19:30</td>
        <td class="not-daily">ØºÙŠØ± ÙŠÙˆÙ…ÙŠ</td>
      </tr>
    </tbody>
  </table>

  <script>
    // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…ÙŠÙ„
    document.getElementById('clientFilter').addEventListener('change', function() {
      const client = this.value;
      const rows = document.querySelectorAll('#recordsTable tbody tr');
      rows.forEach(row => {
        if (!client || row.dataset.client === client) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    });

    // ÙØ±Ø² Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
    function sortTable(n) {
      const table = document.getElementById("recordsTable");
      let switching = true, dir = "asc", switchcount = 0;
      while (switching) {
        switching = false;
        const rows = table.rows;
        for (let i = 1; i < rows.length - 1; i++) {
          let shouldSwitch = false;
          let x = rows[i].getElementsByTagName("TD")[n];
          let y = rows[i + 1].getElementsByTagName("TD")[n];
          let xVal = isNaN(x.innerText) ? x.innerText.toLowerCase() : parseFloat(x.innerText);
          let yVal = isNaN(y.innerText) ? y.innerText.toLowerCase() : parseFloat(y.innerText);
          if (dir === "asc" ? xVal > yVal : xVal < yVal) {
            shouldSwitch = true;
            break;
          }
        if (shouldSwitch) {
          rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
          switching = true;
          switchcount++;
        }
        }
        if (switchcount === 0 && dir === "asc") {
          dir = "desc";
          switching = true;
        }
      }
    }

    // Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ±
    function sendReport() {
      alert("ğŸ“„ Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± (Ø§Ø±Ø¨Ø· Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ø§Ø­Ù‚Ù‹Ø§)");
    }
  </script>

</body>
</html> 
<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            direction: rtl;
            text-align: right;
            padding: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px 12px;
            border: 1px solid #ddd;
        }
        th {
            background-color: #f5f5f5;
        }
        .daily-yes {
            color: green;
            font-weight: bold;
        }
        .daily-no {
            color: red;
            font-weight: bold;
        }
        .notes {
            font-weight: bold;
        }
        .btn-report {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 5px 12px;
            cursor: pointer;
            border-radius: 4px;
        }
        .btn-report:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

<h2>Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù„Ù„Ø¹Ù…ÙŠÙ„: {{ customer_name }}</h2>

<table id="queriesTable">
    <thead>
        <tr>
            <th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
            <th>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ (GB)</th>
            <th>Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ù…Ù†Ø° Ø¢Ø®Ø± ØªÙ‚Ø±ÙŠØ± (GB)</th>
            <th>Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ (GB)</th>
            <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ</th>
            <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
            <th>Ø§Ù„ÙŠÙˆÙ…ÙŠ</th>
            <th>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</th>
            <th>ÙˆÙ‚Øª Ù…Ù†Ø° Ø¢Ø®Ø± Ø§Ø³ØªØ¹Ù„Ø§Ù…</th>
            <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
            <th>Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ±</th>
        </tr>
    </thead>
    <tbody>
        {% for q in queries %}
        <tr>
            <td>{{ q.phone_number }}</td>
            <td>{{ "%.2f"|format(q.avblnce) }}</td>
            <td>{{ "%.2f"|format(q.consumption_since_last) }}</td>
            <td>{{ "%.2f"|format(q.daily_consumption) }}</td>
            <td>{{ "%.2f"|format(q.amount_consumed) }}</td>
            <td>{{ "%.2f"|format(q.amount_remaining) }}</td>
            <td>{{ "Ù†Ø¹Ù…" if q.daily else "Ù„Ø§" }}</td>
            <td>{{ q.days_remaining if q.days_remaining is not none else "â€”" }}</td>
            <td>{{ datetime_ar(q.query_time) }}</td>
            <td>{{ q.time_since_last if q.time_since_last else "â€”" }}</td>
            <td>{{ q.notes }}</td>
            <td><button class="btn-report" onclick="sendReport({{ q.id }})">Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ±</button></td>
        </tr>
        
        {% endfor %}
    </tbody>
</table>


<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script>
$(document).ready(function() {
    $('#queriesTable').DataTable({
        "order": [[ 8, "desc" ]],  // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…
        "pageLength": 25,
        "language": {
            "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/ar.json"
        }
    });
});

function sendReport(queryId) {
    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ API Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
    fetch(`/send_report/${queryId}`, {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => alert(data.message))
    .catch(err => alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±'));
}
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            direction: rtl;
            text-align: right;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h2 {
            margin-bottom: 20px;
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #fff;
        }
        th, td {
            padding: 10px 15px;
            border: 1px solid #ddd;
            text-align: center;
        }
        th {
            background-color: #007bff;
            color: #fff;
        }
        tr:nth-child(even) {
            background-color: #f5f5f5;
        }
        .daily-yes {
            color: green;
            font-weight: bold;
        }
        .daily-no {
            color: red;
            font-weight: bold;
        }
        .notes {
            font-weight: bold;
            color: #444;
        }
        .btn-report {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 6px 12px;
            cursor: pointer;
            border-radius: 4px;
        }
        .btn-report:hover {
            background-color: #218838;
        }
        .filter-container {
            margin-bottom: 15px;
        }
        .filter-container label {
            margin-right: 10px;
            font-weight: bold;
        }
        .filter-container select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>

<h2>Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù„Ù„Ø¹Ù…ÙŠÙ„: {{ customer_name }}</h2>

<div class="filter-container">
    <label>ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ:</label>
    <select id="dailyFilter">
        <option value="all">Ø§Ù„ÙƒÙ„</option>
        <option value="yes">ÙŠÙˆÙ…ÙŠ ÙÙ‚Ø·</option>
        <option value="no">ØºÙŠØ± ÙŠÙˆÙ…ÙŠ ÙÙ‚Ø·</option>
    </select>
</div>

<table id="queriesTable">
    <thead>
        <tr>
            <th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
            <th>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ (GB)</th>
            <th>Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ù…Ù†Ø° Ø¢Ø®Ø± ØªÙ‚Ø±ÙŠØ± (GB)</th>
            <th>Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ (GB)</th>
            <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ</th>
            <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
            <th>Ø§Ù„ÙŠÙˆÙ…ÙŠ</th>
            <th>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</th>
            <th>ÙˆÙ‚Øª Ù…Ù†Ø° Ø¢Ø®Ø± Ø§Ø³ØªØ¹Ù„Ø§Ù…</th>
            <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
            <th>Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ±</th>
        </tr>
    </thead>
    <tbody>
        {% for q in queries %}
        <tr>
            <td>{{ q.phone_number }}</td>
            <td>{{ "%.2f"|format(q.avblnce) }}</td>
            <td>{{ "%.2f"|format(q.consumption_since_last) }}</td>
            <td>{{ "%.2f"|format(q.daily_consumption) }}</td>
            <td>{{ "%.2f"|format(q.amount_consumed) }}</td>
            <td>{{ "%.2f"|format(q.amount_remaining) }}</td>
            <td class="{{ 'daily-yes' if q.daily else 'daily-no' }}">{{ "Ù†Ø¹Ù…" if q.daily else "Ù„Ø§" }}</td>
            <td>{{ q.days_remaining if q.days_remaining is not none else "â€”" }}</td>
            <td>{{ datetime_ar(q.query_time) }}</td>
            <td>{{ q.time_since_last if q.time_since_last else "â€”" }}</td>
            <td class="notes">{{ q.notes }}</td>
            <td><button class="btn-report" onclick="sendReport({{ q.id }})">Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ±</button></td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script>
$(document).ready(function() {
    var table = $('#queriesTable').DataTable({
        "order": [[ 8, "desc" ]],  // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…
        "pageLength": 25,
        "language": {
            "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/ar.json"
        }
    });

    // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ
    $('#dailyFilter').on('change', function () {
        var val = $(this).val();
        if(val === 'all') {
            table.search('').draw();
        } else if(val === 'yes') {
            table.column(6).search('Ù†Ø¹Ù…').draw();
        } else if(val === 'no') {
            table.column(6).search('Ù„Ø§').draw();
        }
    });
});

function sendReport(queryId) {
    fetch(`/send_report/${queryId}`, { method: 'POST' })
        .then(response => response.json())
        .then(data => alert(data.message))
        .catch(err => alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±'));
}
</script>

</body>
</html>-->
<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… - Ø§Ù„Ø¹Ù…ÙŠÙ„ {{ customer_name }}</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.dataTables.min.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            direction: rtl;
            text-align: right;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h2 {
            margin-bottom: 20px;
            color: #333;
        }
        .filters {
            margin-bottom: 15px;
        }
        .filters label {
            margin-right: 10px;
            font-weight: bold;
        }
        .filters select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #fff;
        }
        th, td {
            padding: 10px 12px;
            border: 1px solid #ddd;
            text-align: center;
        }
        th {
            background-color: #007bff;
            color: #fff;
        }
        tr:nth-child(even) {
            background-color: #f5f5f5;
        }
        .daily-yes { color: green; font-weight: bold; }
        .daily-no { color: red; font-weight: bold; }
        .notes { font-weight: bold; color: #444; }
        .btn-report {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 6px 12px;
            cursor: pointer;
            border-radius: 4px;
        }
        .btn-report:hover { background-color: #218838; }
    </style>
</head>
<body>

<h2>Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù„Ù„Ø¹Ù…ÙŠÙ„: {{ customer_name }}</h2>

<div class="filters">
    <label>ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ:</label>
    <select id="dailyFilter">
        <option value="all">Ø§Ù„ÙƒÙ„</option>
        <option value="yes">ÙŠÙˆÙ…ÙŠ ÙÙ‚Ø·</option>
        <option value="no">ØºÙŠØ± ÙŠÙˆÙ…ÙŠ ÙÙ‚Ø·</option>
    </select>

    <label>ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø±Ù‚Ù…:</label>
    <select id="phoneFilter">
        <option value="all">Ø§Ù„ÙƒÙ„</option>
        {% for q in queries %}
            <option value="{{ q.phone_number }}">{{ q.phone_number }}</option>
        {% endfor %}
    </select>
</div>

<table id="queriesTable">
    <thead>
        <tr>
            <th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
            <th>Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ (GB)</th>
            <th>Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ù…Ù†Ø° Ø¢Ø®Ø± ØªÙ‚Ø±ÙŠØ± (GB)</th>
            <th>Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ (GB)</th>
            <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ</th>
            <th>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
            <th>Ø§Ù„ÙŠÙˆÙ…ÙŠ</th>
            <th>Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…</th>
            <th>ÙˆÙ‚Øª Ù…Ù†Ø° Ø¢Ø®Ø± Ø§Ø³ØªØ¹Ù„Ø§Ù…</th>
            <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
            <th>Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ±</th>
        </tr>
    </thead>
    <tbody>
        {% for q in queries %}
        <tr data-phone="{{ q.phone_number }}">
            <td>{{ q.phone_number }}</td>
            <td>{{ "%.2f"|format(q.avblnce) }}</td>
            <td>{{ "%.2f"|format(q.consumption_since_last) }}</td>
            <td>{{ "%.2f"|format(q.daily_consumption) }}</td>
            <td>{{ "%.2f"|format(q.amount_consumed) }}</td>
            <td>{{ "%.2f"|format(q.amount_remaining) }}</td>
            <td class="{{ 'daily-yes' if q.daily else 'daily-no' }}">{{ "Ù†Ø¹Ù…" if q.daily else "Ù„Ø§" }}</td>
            <td>{{ q.days_remaining if q.days_remaining is not none else "â€”" }}</td>
            <td>{{ datetime_ar(q.query_time) }}</td>
            <td>{{ q.time_since_last if q.time_since_last else "â€”" }}</td>
            <td class="notes">{{ q.notes }}</td>
            <td><button class="btn-report" onclick="sendReport({{ q.id }})">Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ±</button></td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script>
$(document).ready(function() {
    var table = $('#queriesTable').DataTable({
        "order": [[ 8, "desc" ]],
        "pageLength": 25,
        "language": { "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/ar.json" }
    });

    // ÙÙ„ØªØ±Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠ
    $('#dailyFilter').on('change', function() {
        var val = $(this).val();
        if(val === 'all') table.column(6).search('').draw();
        else table.column(6).search(val === 'yes' ? 'Ù†Ø¹Ù…' : 'Ù„Ø§').draw();
    });

    // ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø±Ù‚Ù…
    $('#phoneFilter').on('change', function() {
        var val = $(this).val();
        if(val === 'all') table.column(0).search('').draw();
        else table.column(0).search('^'+val+'$', true, false).draw();
    });
});

function sendReport(queryId) {
    fetch(`/send_report/${queryId}`, { method: 'POST' })
        .then(response => response.json())
        .then(data => alert(data.message))
        .catch(err => alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±'));
}
</script>

</body>
</html>


