# 🤖 نظام بوت واتساب المتكامل

نظام متكامل لإدارة بوت واتساب مع واجهة ويب متقدمة، إدارة الجلسات، قاعدة بيانات، ومعالجة الأخطاء.

## 📋 جدول المحتويات

- [المميزات](#-المميزات)
- [متطلبات النظام](#-متطلبات-النظام)
- [التثبيت](#-التثبيت)
- [التشغيل](#-التشغيل)
- [الواجهة](#-الواجهة)
- [API](#-api)
- [التكوين](#-التكوين)
- [استكشاف الأخطاء](#-استكشاف-الأخطاء)
- [المساهمة](#-المساهمة)

## 🌟 المميزات

### 🔧 الميزات الأساسية
- **إدارة الجلسات**: تشغيل، إعادة تشغيل، وقطع اتصال العميل
- **إرسال واستقبال الرسائل**: دعم النصوص والملفات (PDF، صور، فيديوهات)
- **واجهة ويب متقدمة**: لوحة تحكم شاملة مع إحصائيات فورية
- **قاعدة بيانات SQLite**: تخزين الجلسات، الرسائل، والأخطاء
- **معالجة الأخطاء**: نظام مراقبة تلقائي مع إعادة التشغيل

### 🎨 واجهة المستخدم
- **تصميم متجاوب**: يعمل على جميع الأجهزة
- **5 أقسام رئيسية**: لوحة التحكم، الرسائل، إدارة الجلسة، QR، السجلات
- **إشعارات فورية**: تحديثات مباشرة للحالة
- **رسوم بيانية**: إحصائيات بصرية للنشاط

### 🔌 API متكامل
- **RESTful API**: نقاط وصول شاملة للتحكم
- **دعم rفع الملفات**: إرسال المرفقات عبر API
- **توثيق تلقائي**: جميع المسارات موثقة

## 💻 متطلبات النظام

### البرمجيات المطلوبة
- **Node.js**: الإصدار 18.0.0 أو أحدث
- **pnpm**: مدير الحزم (يفضل) أو npm
- **Google Chrome**: متصفح Chrome مثبت على النظام
- **نظام التشغيل**: Windows 10/11, macOS, أو Linux

### المتطلبات التقنية
- **الذاكرة**: 2GB RAM على الأقل
- **التخزين**: 500MB مساحة فارغة
- **الشبكة**: اتصال إنترنت مستقر

## 🚀 التثبيت

### 1. تحميل المشروع
```bash
git clone <repository-url>
cd whatsappnewbot
```

### 2. تثبيت الحزم
```bash
# باستخدام pnpm (مستحسن)
pnpm install

# أو باستخدام npm
npm install
```

### 3. التحقق من Chrome
تأكد من تثبيت Google Chrome على نظامك.

## ▶️ التشغيل

### التشغيل الأساسي
```bash
# باستخدام pnpm
pnpm start

# أو باستخدام npm
npm start
```

### التشغيل في وضع التطوير
```bash
# باستخدام nodemon
pnpm dev
# أو
npm run dev
```

### التشغيل المباشر
```bash
node whatsapp-bot-clean.js
```

## 🌐 الواجهة

بعد تشغيل النظام، ستكون الواجهة متاحة على:
- **الرابط المحلي**: http://localhost:3000
- **لوحة التحكم**: http://localhost:3000/
- **API**: http://localhost:3000/api

### أقسام الواجهة

#### 📊 لوحة التحكم
- عرض حالة النظام في الوقت الفعلي
- إحصائيات الرسائل والأخطاء
- معلومات الجلسة ووقت التشغيل
- أزرار التحكم السريع

#### 💬 إدارة الرسائل
- إرسال رسائل نصية وملفات
- عرض الرسائل الواردة والمرسلة
- فلترة وبحث في الرسائل
- دعم جميع أنواع الملفات

#### ⚙️ إدارة الجلسة
- معلومات الجلسة الحالية
- أزرار التحكم (تشغيل، إعادة تشغيل، إيقاف)
- حالة الاتصال وبيانات المستخدم

#### 📱 رمز QR
- عرض رمز QR للمسح
- تعليمات الربط مع الهاتف
- تحديث تلقائي للرمز

#### 📝 السجلات
- عرض الأخطاء والتحذيرات
- سجل النشاطات
- إحصائيات مفصلة

## 🔌 API

### نقاط الوصول الأساسية

#### الحالة العامة
```http
GET /api/status
```
إرجاع معلومات شاملة عن حالة النظام.

#### إرسال رسالة
```http
POST /api/send-message
Content-Type: multipart/form-data

phoneNumber: 966xxxxxxxxx
message: نص الرسالة
media: [ملف اختياري]
```

#### إدارة الجلسة
```http
GET /api/restart      # إعادة تشغيل
GET /api/disconnect   # قطع الاتصال
GET /api/qr          # الحصول على رمز QR
```

#### البيانات
```http
GET /api/messages    # الحصول على الرسائل
GET /api/errors      # الحصول على الأخطاء
```

### أمثلة الاستخدام

#### إرسال رسالة نصية
```javascript
const formData = new FormData();
formData.append('phoneNumber', '966501234567');
formData.append('message', 'مرحباً من البوت!');

fetch('/api/send-message', {
    method: 'POST',
    body: formData
})
.then(response => response.json())
.then(data => console.log(data));
```

#### إرسال رسالة مع ملف
```javascript
const formData = new FormData();
formData.append('phoneNumber', '966501234567');
formData.append('message', 'إليك هذا الملف');
formData.append('media', fileInput.files[0]);

fetch('/api/send-message', {
    method: 'POST',
    body: formData
});
```

## ⚙️ التكوين

### متغيرات البيئة
أنشئ ملف `.env` في المجلد الجذر:

```env
# منفذ الخادم
PORT=3000

# رابط النظام الأصلي (اختياري)
API_BASE_URL=http://localhost:4000

# مستوى التسجيل
LOG_LEVEL=info
```

### إعدادات قاعدة البيانات
يستخدم النظام SQLite افتراضياً. ملف قاعدة البيانات:
```
whatsapp_sessions.db
```

### إعدادات الجلسة
```javascript
// مسار تخزين الجلسات
dataPath: './sessions'

// معرف الجلسة
clientId: 'whatsapp-bot-session'
```

## 🔧 استكشاف الأخطاء

### المشاكل الشائعة

#### 1. خطأ Chrome/Chromium
```
Error: Could not find expected browser (chrome) locally
```
**الحل**: تأكد من تثبيت Google Chrome على نظامك.

#### 2. خطأ المنفذ مستخدم
```
Error: listen EADDRINUSE: address already in use :::3000
```
**الحل**: قم بتغيير المنفذ في متغيرات البيئة أو أغلق العملية المستخدمة للمنفذ.

#### 3. مشاكل الأذونات
```
Error: EACCES: permission denied
```
**الحل**: تأكد من أذونات الكتابة في مجلد المشروع.

### نصائح الأداء

1. **تحسين الذاكرة**: أعد تشغيل النظام دورياً لتحرير الذاكرة
2. **تنظيف السجلات**: احذف السجلات القديمة بانتظام
3. **مراقبة قاعدة البيانات**: نظف الرسائل القديمة عند الحاجة

### سجلات النظام

#### مستويات التسجيل
- `CLIENT_START`: بدء تشغيل العميل
- `CLIENT_READY`: جاهزية العميل
- `MESSAGE_SENT`: إرسال رسالة
- `MESSAGE_RECEIVED`: استقبال رسالة
- `ERROR`: أخطاء النظام

#### مواقع السجلات
- **الطرفية**: عرض مباشر للأحداث
- **قاعدة البيانات**: جدول `error_logs`
- **الواجهة**: قسم السجلات

## 📁 هيكل المشروع

```
whatsappnewbot/
├── public/                 # ملفات الواجهة
│   ├── css/
│   │   └── main.css       # تنسيقات الواجهة
│   ├── js/
│   │   └── main.js        # أكواد JavaScript
│   └── index.html         # الصفحة الرئيسية
├── sessions/              # ملفات الجلسة (تُنشأ تلقائياً)
├── uploads/               # ملفات مرفوعة (تُنشأ تلقائياً)
├── downloads/             # ملفات محملة (تُنشأ تلقائياً)
├── whatsapp-bot-clean.js  # الملف الرئيسي
├── package.json           # إعدادات المشروع
├── pnpm-lock.yaml         # قفل الحزم
├── whatsapp_sessions.db   # قاعدة البيانات (تُنشأ تلقائياً)
└── README.md              # هذا الملف
```

## 🛠️ التطوير

### إضافة ميزات جديدة
1. أنشئ فرع جديد للميزة
2. اختبر الميزة محلياً
3. أضف التوثيق المناسب
4. أرسل طلب دمج

### معايير الكود
- استخدم التعليقات العربية للوضوح
- اتبع نمط async/await
- أضف معالجة الأخطاء لجميع الدوال
- اختبر على متصفحات متعددة

## 🔒 الأمان

### أفضل الممارسات
- لا تشارك بيانات الجلسة
- استخدم HTTPS في الإنتاج
- قم بتحديث الحزم بانتظام
- راقب السجلات للأنشطة المشبوهة

### حماية البيانات
- الرسائل مشفرة محلياً
- لا يتم تخزين كلمات المرور
- جلسات محمية بمفاتيح فريدة

## 🤝 المساهمة

نرحب بالمساهمات! يرجى:

1. فتح قضية (Issue) لمناقشة التغييرات
2. إنشاء فرع للميزة الجديدة
3. كتابة اختبارات للكود الجديد
4. التأكد من اتباع معايير الكود
5. إرسال طلب دمج مع وصف واضح

## 📄 الترخيص

هذا المشروع مرخص تحت رخصة MIT. راجع ملف `LICENSE` للتفاصيل.

## 👨‍💻 المطور

**HASRIAN TOPTECH**
- تطوير وتصميم النظام
- الواجهة والتجربة
- معالجة الأخطاء والأمان

## 🙏 شكر وتقدير

شكر خاص لمطوري:
- whatsapp-web.js
- Express.js
- SQLite
- Font Awesome

## 📞 الدعم

للحصول على الدعم:
1. تحقق من قسم [استكشاف الأخطاء](#-استكشاف-الأخطاء)
2. ابحث في القضايا المفتوحة
3. افتح قضية جديدة مع تفاصيل المشكلة
4. راسل المطور للدعم المباشر

## 🔄 التحديثات

### الإصدار 1.0.0
- إطلاق النظام الأساسي
- واجهة ويب متكاملة
- دعم كامل للرسائل والملفات
- قاعدة بيانات ومعالجة أخطاء

---

**تم تطوير هذا النظام بعناية لتوفير تجربة مستخدم ممتازة وأداء موثوق. استمتع بالاستخدام! 🚀**
